version: 0.7.{build}-{branch}

image: 
 - Visual Studio 2017

configuration:
  # - Debug
  - Release

install:
  - echo "Downloading conan..."
  - set PATH=%PATH%;%PYTHON%/Scripts/
  - pip.exe install conan
  - conan remote add owl https://api.bintray.com/conan/zethon/owl
  - conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan

build_script:
  - mkdir build
  - cd build
  - conan install .. --build missing -s build_type=%configuration%
  - cmake .. -DCMAKE_BUILD_TYPE=%configuration% "-GVisual Studio 15 2017 Win64" -DCMAKE_PREFIX_PATH=C:/Qt/5.11/msvc2017_64 -DBUILD_GUI=ON -DBUILD_CONSOLE=OFF -DBUILD_TEST=ON
  - cmake --build . --config %configuration% -- /maxcpucount:4

test_script:
  - set PATH=%PATH%;C:\Qt\5.11\msvc2017_64\bin
  # - echo %PATH%
  # - dir /s .
  - ctest -VV -C "%configuration%" --output-on-failure

after_build:
  cmd: set
  cmd: echo "build number "
  cmd: echo %APPVEYOR_BUILD_NUMBER%
  cmd: echo "build version "
  cmd: echo %APPVEYOR_BUILD_NUMBER%
  cmd: copy src\%configuration%\Owl.exe .\Owl-%configuration%.exe
  cmd: dir *.exe

artifacts:
  - path: Owl-Release.exe
    name: OwlInstaller
